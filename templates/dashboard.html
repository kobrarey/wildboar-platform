<!doctype html>
<html lang="{{ 'en' if lang == 'en' else 'ru' }}">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WildBoar ‚Äî {{ 'Personal account' if lang == 'en' else '–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç' }}</title>
  <link rel="stylesheet" href="/static/css/app.css?v=portfolio7" />
  <script defer src="/static/js/app.js?v=5_2"></script>
</head>

<body class="page page--dashboard">
  <aside class="sidebar" id="sidebar">
    <div class="sidebar__brand">
      <div class="brand">
        <div class="brand__mark" aria-hidden="true"></div>
        <div class="brand__text">wildboar</div>
      </div>

      <button class="icon-btn sidebar__toggle" type="button" aria-label="{{ 'Menu' if lang == 'en' else '–ú–µ–Ω—é' }}" data-sidebar-toggle>
        <span class="icon-btn__bar"></span>
        <span class="icon-btn__bar"></span>
        <span class="icon-btn__bar"></span>
      </button>
    </div>

    <div class="sidebar__title">{{ 'Personal account' if lang == 'en' else '–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç' }}</div>

    <nav class="sidebar__nav">
      <a class="sidebar__link sidebar__link--active nav-item" href="/dashboard">
        <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="8" width="18" height="13" rx="2" ry="2"></rect>
          <path d="M3 10a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v0"></path>
          <path d="M8 6h8"></path>
          <path d="M12 2v4"></path>
        </svg>
        <span class="nav-dot" aria-hidden="true"></span>
        <span class="nav-label">{{ 'My portfolio' if lang == 'en' else '–ú–æ–π –ø–æ—Ä—Ç—Ñ–µ–ª—å' }}</span>
      </a>  
      <button type="button" class="sidebar__link nav-item sidebar-item" data-href="/settings/security">
        <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
        </svg>
        <span class="nav-dot" aria-hidden="true"></span>
        <span class="nav-label">{% if lang == 'en' %}Security settings{% else %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏{% endif %}</span>
      </button>
    </nav>

    <div class="sidebar__footer">
      <a class="btn btn--light btn--block sidebar__logout" href="/logout">
        <svg class="sidebar__logout-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="5" width="12" height="14" rx="1" stroke="currentColor"></rect>
          <path d="M9 12h8"></path>
          <path d="M15 8l4 4-4 4"></path>
        </svg>
        <span class="sidebar__logout-text">{{ 'Log out' if lang == 'en' else '–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞' }}</span>
      </a>
    </div>
  </aside>

  <div class="dash">
    <header class="dash__top">
      <a class="btn btn--primary btn--small" href="/">{{ 'Back to website' if lang == 'en' else '–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç' }}</a>

      <div class="dash__top-right">
      <div class="user-header">
        <span class="account-type-badge">
          {% if account_type == 'vip' %}
            VIP
          {% elif account_type == 'employee' %}
            {% if lang == 'en' %}Staff{% else %}–°–æ—Ç—Ä—É–¥–Ω–∏–∫{% endif %}
          {% elif account_type == 'manager' %}
            {% if lang == 'en' %}Manager{% else %}–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å{% endif %}
          {% else %}
            {% if lang == 'en' %}Basic{% else %}–ë–∞–∑–æ–≤—ã–π{% endif %}
          {% endif %}
        </span>

        <div class="user-meta">
          <span class="user-name">{{ user.first_name }} {{ user.last_name }}</span>
          <span class="user-email">{{ user.email }}</span>
        </div>
      </div>

      <div class="lang-switcher">
        <button data-lang-toggle class="icon-button" type="button">üåê</button>
        <div class="lang-dropdown hidden">
          <button type="button" data-lang="ru">–†—É—Å—Å–∫–∏–π</button>
          <button type="button" data-lang="en">English</button>
        </div>
      </div>
      </div>
    </header>

    <main class="dash__content dash__content--portfolio">
      <h1 class="dash__h1 dash__h1--portfolio">{{ 'My portfolio' if lang == 'en' else '–ú–æ–π –ø–æ—Ä—Ç—Ñ–µ–ª—å' }}</h1>

      {# --- Portfolio UI (stage 6) --- #}

      {% set active_funds = portfolio.funds | selectattr('category', 'equalto', 'active') | list %}
      {% set index_funds  = portfolio.funds | selectattr('category', 'equalto', 'index')  | list %}
      {% set test_funds   = portfolio.funds | selectattr('category', 'equalto', 'test')   | list %}

      <div class="card portfolio-card">
        <div class="card__body">
          <div class="portfolio-header__row1">
            <div class="portfolio-metric">
              <div class="p-label">{{ '–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å' if lang == 'ru' else 'Current balance' }}</div>
              <div class="p-value">{{ '%.2f'|format(portfolio.current_balance or 0) }} {{ portfolio.stable_symbol or 'USDT' }}</div>
            </div>
            <div class="portfolio-metric portfolio-metric--right">
              <div class="p-label">{{ '–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å' if lang == 'ru' else 'Change over last day' }}</div>
              <div class="p-value">
                {% if portfolio.daily_change_pct is not none %}
                  {% if portfolio.daily_change_pct > 0 %}+{% endif %}{{ '%.2f'|format(portfolio.daily_change_pct) }}%
                {% else %}
                  ‚Äî
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>

      <section class="funds-section">
        <h2 class="funds-title">
          {% if lang == 'en' %}Stablecoin balance{% else %}–ë–∞–ª–∞–Ω—Å —Å—Ç–µ–π–±–ª–∫–æ–∏–Ω–æ–≤{% endif %}
        </h2>

        <div class="card">
          <div class="card__body stablecoin-card">
            <div class="stablecoin-card__content">
              <div class="stablecoin-balance">
                <span class="p-label">{{ portfolio.stable_symbol or 'USDT' }}</span>
                <span class="stablecoin-value">{{ '%.2f'|format(portfolio.stable_balance or 0) }}</span>
              </div>
              <div class="stablecoin-actions">
                <button class="btn btn--primary btn--small" type="button" disabled aria-disabled="true">
                  {{ '–ü–æ–ø–æ–ª–Ω–∏—Ç—å' if lang == 'ru' else 'Deposit' }}
                </button>
                <button class="btn btn--primary btn--small" type="button" disabled aria-disabled="true">
                  {{ '–í—ã–≤–µ—Å—Ç–∏' if lang == 'ru' else 'Withdraw' }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      {% if active_funds %}
      <section class="funds-section">
        <h2 class="funds-title">
          {% if lang == 'en' %}Actively managed funds{% else %}–§–æ–Ω–¥—ã –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è{% endif %}
        </h2>

        <div class="card">
          <div class="card__body funds-table">
            <div class="funds-header">
              <span class="col-name">{{ '–§–æ–Ω–¥' if lang == 'ru' else 'Fund' }}</span>
              <span class="col-price">{{ '–¶–µ–Ω–∞' if lang == 'ru' else 'Price' }}</span>
              <span class="col-qty">{{ '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ' if lang == 'ru' else 'Quantity' }}</span>
              <span class="col-value">{{ '–°—Ç–æ–∏–º–æ—Å—Ç—å' if lang == 'ru' else 'Value' }}</span>
              <span class="col-action"></span>
            </div>

            {% for f in active_funds %}
            <div class="fund-row">
              <span class="col-name">{{ f.name }}</span>
              <span class="col-price">{{ '%.2f'|format(f.price or 0) }} USDT</span>
              <span class="col-qty">{{ '%.4f'|format(f.shares or 0) }}</span>
              <span class="col-value">{{ '%.2f'|format(f.value or 0) }} USDT</span>
              <span class="col-action">
                <button class="btn btn--primary btn--small" type="button" disabled aria-disabled="true">
                  {{ '–ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å' if lang == 'ru' else 'Invest' }}
                </button>
              </span>
            </div>
            {% endfor %}
          </div>
        </div>
      </section>
      {% endif %}

      {% if index_funds %}
      <section class="funds-section">
        <h2 class="funds-title">
          {% if lang == 'en' %}Index funds{% else %}–ò–Ω–¥–µ–∫—Å–Ω—ã–µ —Ñ–æ–Ω–¥—ã{% endif %}
        </h2>

        <div class="card">
          <div class="card__body funds-table">
            <div class="funds-header">
              <span class="col-name">{{ '–§–æ–Ω–¥' if lang == 'ru' else 'Fund' }}</span>
              <span class="col-price">{{ '–¶–µ–Ω–∞' if lang == 'ru' else 'Price' }}</span>
              <span class="col-qty">{{ '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ' if lang == 'ru' else 'Quantity' }}</span>
              <span class="col-value">{{ '–°—Ç–æ–∏–º–æ—Å—Ç—å' if lang == 'ru' else 'Value' }}</span>
              <span class="col-action"></span>
            </div>

            {% for f in index_funds %}
            <div class="fund-row">
              <span class="col-name">{{ f.name }}</span>
              <span class="col-price">{{ '%.2f'|format(f.price or 0) }} USDT</span>
              <span class="col-qty">{{ '%.4f'|format(f.shares or 0) }}</span>
              <span class="col-value">{{ '%.2f'|format(f.value or 0) }} USDT</span>
              <span class="col-action">
                <button class="btn btn--primary btn--small" type="button" disabled aria-disabled="true">
                  {{ '–ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å' if lang == 'ru' else 'Invest' }}
                </button>
              </span>
            </div>
            {% endfor %}
          </div>
        </div>
      </section>
      {% endif %}

      {% if test_funds %}
      <section class="funds-section">
        <h2 class="funds-title">
          {% if lang == 'en' %}Test funds{% else %}–¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–æ–Ω–¥—ã{% endif %}
        </h2>

        <div class="card">
          <div class="card__body funds-table">
            <div class="funds-header">
              <span class="col-name">{{ '–§–æ–Ω–¥' if lang == 'ru' else 'Fund' }}</span>
              <span class="col-price">{{ '–¶–µ–Ω–∞' if lang == 'ru' else 'Price' }}</span>
              <span class="col-qty">{{ '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ' if lang == 'ru' else 'Quantity' }}</span>
              <span class="col-value">{{ '–°—Ç–æ–∏–º–æ—Å—Ç—å' if lang == 'ru' else 'Value' }}</span>
              <span class="col-action"></span>
            </div>

            {% for f in test_funds %}
            <div class="fund-row">
              <span class="col-name">{{ f.name }}</span>
              <span class="col-price">{{ '%.2f'|format(f.price or 0) }} USDT</span>
              <span class="col-qty">{{ '%.4f'|format(f.shares or 0) }}</span>
              <span class="col-value">{{ '%.2f'|format(f.value or 0) }} USDT</span>
              <span class="col-action">
                <button class="btn btn--primary btn--small" type="button" disabled aria-disabled="true">
                  {{ '–ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å' if lang == 'ru' else 'Invest' }}
                </button>
              </span>
            </div>
            {% endfor %}
          </div>
        </div>
      </section>
      {% endif %}

      {# --- /Portfolio UI --- #}
    </main>
  </div>

  <!-- –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é -->
  <div class="backdrop" id="backdrop" hidden></div>
</body>
</html>
